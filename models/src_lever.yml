# for source packages/pulling from the raw connector data

version: 2

sources:
  - name: lever 
    database: "{{ var ('lever_database', target.database) }}"
    schema: "{{ var ('lever_schema', 'lever') }}"

    loader: fivetran
    loaded_at_field: _fivetran_synced
      
    freshness:
      warn_after: {count: 72, period: hour}
      error_after: {count: 96, period: hour}

    # do tests on staging models bc of circleci testing
    tables:
      - name: opportunity
        description: > 
          Opportunities represent each candidates' individual journeys/candidacies through
          your pipeline. An individual candidate might have multiple opportunties if
          applying to multiple job postings. 
        columns:
          - name: id
            description: Unique ID of the opportunity.
          - name: archived_at
            description: Timestamp of when the opportunity was archived. 
          - name: archived_reason_id
            description: Foreign key referencing the ARCHIVE_REASON for which the opportunity was archived.
          - name: contact
            description: Foreign key referencing the CONTACT info of the candidate applying in this opportunity.
          - name: created_at
            description: >
              Timestamp of when the opportunity was created (ie when the candidate clicked "apply" on your
              company website).
          - name: data_protection_contact_allowed
            description: >
              Boolean that is true if relevant data policy regulations allow for contacting 
              this opportunity's candidate.
          - name: data_protection_contact_expires_at
            description: Timestamp of when this permission/data policy expires.
          - name: data_protection_store_allowed
            description: >
              Boolean that is true if relevant data policy regulations allow for storing 
              this opportunity record.
          - name: data_protection_store_expires_at
            description: Timestamp of when this permission/data policy expires.
          - name: headline
            description: > 
              Contact headline, typically a list of previous companies where the contact has worked or 
              schools that the contact has attended.
          - name: is_anonymized
            description: >
              Boolean that is true if the opportunity has been anonymized (therefore fully anonymizing 
              the contact and removing their *personal* information).
          - name: last_advanced_at
            description: >
              Timestamp of when the candidate advanced to their current stage in the hiring pipeline.
          - name: last_interaction_at
            description: >
              Timestamp of when the Opportunity profile was last interacted with. See interactions
              [here](https://help.lever.co/hc/en-us/articles/205697619).
          - name: location
            description: Current contact location of the candidate.
          - name: name
            description: Contact full name.
          - name: origin
            description: >
              The way in which the opportunity was added to lever. Includes 'agency', 'applied', 'internal',
              'referred', 'sourced', and 'university'.
          - name: owner_id
            description: Foreign key referencing the id of the USER who owns this opportunity.
          - name: snoozed_until
            description: Timestamp of when the current snooze period of this opportunity ends (if snoozed).
          - name: stage_id
            description: Foreign key referencing the ID of the current stage of the opportunity.
          - name: updated_at
            description: Timestamp of when the opportunity was last updated in lever.

      - name: posting
        description: Table capturing job postings that candidates can apply to.
        columns:
          - name: id
            description: Unique ID of the job posting. 
          - name: _fivetran_deleted
            description: Boolean that is true if the posting has been soft-deleted.
          - name: categories_commitment
            description: Tag for job position work type (e.g. Full-time, Part-time, Internship).
          - name: categories_department
            description: Tag for the department to which the job posting's team belongs, if present.
          - name: categories_level
            description: >
              Tag for job posting level (e.g. Senior, Junior). Note - this has been deprecated by Lever 
              but is currently maintained for backward compatibility.
          - name: categories_location
            description: Tag for job position location.
          - name: categories_team
            description: >
              Tag for the team to which the job posting belongs (a sub-category of department).
          - name: content_closing
            description: Closing statement on the job posting, in plaintext. 
          - name: content_closing_html
            description: Closing statement on job posting, as styled HTML.
          - name: content_description
            description: Job posting description that is shown at the top of the job's page, as plaintext.
          - name: content_description_html
            description: Job posting description that is shown at the top of the job's page, in HTML.
          - name: created_at
            description: Timestamp of when the posting was created in Lever.
          - name: creator_id
            description: Foreign key referencing the id of the USER who created the job posting. 
          - name: owner_id
            description: >
              Foreign key referencing the id of the USER who owns the posting. The posting owner is the 
              individual who is directly responsible for managing all candidates who are applied to that role.
          - name: requisition_code
            description: Array of requisition codes associated with this posting.
          - name: state
            description: >
              Current status of the posting, which may include 'published', 'internal' (called 'unlisted' in the UI),
              'closed', 'draft', 'pending' (awaiting approval), and 'rejected'.
          - name: text
            description: Title of the job posting role.
          - name: updated_at
            description: Timestamp of when the posting was last updated.

      - name: posting_tag
        description: Table associating job postings with all associated tags.
        columns:
          - name: posting_id
            description: Foreign key referencing the id of the job POSTING.
          - name: tag 
            description: Text of the posting's individual tag.
          - name: _fivetran_deleted
            description: Boolean that is true if the posting-tag association has been deleted.
            
      - name: posting_interview
        description: Table relating job postings to any interviews undertaken for the role.
        columns:
          - name: interview_id
            description: Foreign key referencing the INTERVIEW for this job posting.
          - name: posting_id
            description: Foreign key referencing the POSTING that was interviewed for.

      - name: user
        description: Table of Lever users (anyone who has been invited to join the recruiting efforts).
        columns:
          - name: id
            description: Unique id of the user. 
          - name: _fivetran_deleted
            description: Boolean that is true if the user has been soft-deleted. 
          - name: access_role
            description: >
              The user's access role, which can be 'super admin', 'admin', 'team member', 'limited team member', or 'interviewer'.
              Information on what the roles entail can be found 
              [here](https://help.lever.co/hc/en-us/articles/360042645691-What-are-the-differences-between-access-roles-in-Lever-#:~:text=There%20are%205%20different%20access,information%2C%20and%20permission%20granting%20privileges).
          - name: created_at
            description: Timestamp of when the user was created. 
          - name: deactivated_at
            description: Timestamp of when the user was deactivated (null for active users). 
          - name: email
            description: The user's email address.
          - name: external_directory_id
            description: Unique ID of the user in an external HR directory, if provided.
          - name: name
            description: User's preferred name.
          - name: photo
            description: URL for user's gravatar, if enabled.
          - name: username
            description: Username, extracted from user's email address.

      - name: interview_user
        description: Table relating interviews to their interviewers.
        columns:
          - name: interview_id
            description: Foreign key referencing the INTERVIEW that was given.
          - name: user_id 
            description: Foreign key referencing the USER that interviewed the candidate.

      - name: opportunity_stage_history
        description: Table capturing the different stages that each opportunity has passed through in the pipeline.
        columns:
          - name: opportunity_id
            description: Foreign key referencing the id of the OPPORTUNITY.
          - name: updated_at
            description: Timestamp of when the opportunity was changed to this stage.
          - name: stage_id
            description: Foreign key referencing the STAGE that the opportunity was changed to.
          - name: updater_id
            description: Foreign key referencing the USER who changed the opportunity stage.

      - name: stage
        description: Table of steps in the recruiting workflow of your hiring pipeline.
        columns:
          - name: id
            description: Unique id of the stage.
          - name: text
            description: Title of the stage.

      - name: opportunity_source
        description: Table relating opportunities to all of their individual sources. 
        columns:
          - name: opportunity_id
            description: Foreign key referencing the OPPORTUNITY that was sourced. 
          - name: source
            description: Where this opportunity was sourced from (ie 'linkedin').

      - name: opportunity_tag 
        description: Table relating opportunities to their tags.
        columns:
          - name: opportunity_id
            description: Foreign key referencing the OPPORTUNITY that was tagged.
          - name: tag
            description: Text of the tag associated with this opportunity.

      - name: application
        description: Table capturing candidate applications to job postings. 
        columns:
          - name: id
            description: Unique ID of the application.
          - name: archived_at
            description: Timestamp of when the application was last archived.
          - name: archived_reason_id
            description: Foreign key referencing the id of the ARCHIVE_REASON for which the application was last archived.
          - name: candidate_id
            description: This field is deprecated - use `opportunity_id` instead!
          - name: comments
            description: Any additional comments from the candidate included in the job application.
          - name: company
            description: The candidate's current company or organization.
          - name: created_at
            description: Timestamp of when the application was created.
          - name: posting_hiring_manager_id
            description: >
              Foreign key referencing the id of the USER who is the job posting's hiring manager, at the time 
              the application was submitted.
          - name: posting_id
            description: Foreign key referencing the job POSTING for which the candidate applied.
          - name: posting_owner_id
            description: >
              Foreign key referencing the id of the USER who owns this posting at the time the candidate applied.
          - name: referrer_id
            description: The user ID of the candidate's referrer. 
          - name: requisition_for_hire_id
            description: >
              If the application was archived as hired against a requisition, a foreign key referencing the id of the
              REQUISITION against which the application was hired.
          - name: type
            description: >
              Type of the application. An application can be of type referral, user, or posting. Applications of type 
              referral are created when a user refers a candidate for a job posting. Applications have type user when they 
              are applied manually to a posting in Lever. Applications have type posting when a candidate applies to a job 
              posting through your company's jobs page.
          - name: opportunity_id
            description: Foreign key referencing the id of the OPPORTUNITY associated with this application.

      - name: offer
        description: Table of the data sent to an opportunity for a position they have been offerred.
        columns:
          - name: id
            description: Unique ID of the offer.
          - name: candidate_id # or opportunity_id - todo
            description: Unique ID of the candidate or opportunity??
          - name: created_at
            description: Timestamp of when the offer was created.
          - name: creator_id
            description: Foreign key referencing the USER who created the offer.
          - name: status
            description: >
              A string describing the current status of the offer. Can include: 
              draft - the offer is still under construction
              approval-sent - the offer needs approval
              approved - the offer has been approved
              sent - the offer has been sent through Lever
              sent-manually - the offer has been sent to the candidate outside of Lever
              opened - the candidate has opened the offer
              denied - the candidate denied the offer
              signed - the candidate signed the offer

      - name: archive_reason 
        description: >
          Table of reasons for archiving candidates, exiting them from the hiring pipeline (after hiring or rejecting 
          for a particular reason).
        columns:
          - name: id
            description: Unique id of the archive reason.
          - name: text
            description: Name of the archive reason as shown in the Lever UI. 
          - name: _fivetran_deleted
            description: Boolean that is true if the archive reason has been soft-deleted.

      - name: interview
        description: Table capturing individual interviews (which comprise panels).
        columns:
          - name: id
            description: Unique ID of the interview. 
          - name: canceled_at
            description: Timestamp of when the interview was canceled, if canceled.
          - name: created_at
            description: Timestamp of when the interview was created.
          - name: creator_id
            description: Foreign key referencing the USER who created the interview in lever.
          - name: date
            description: Date + time at which the interview was set to occur.
          - name: duration
            description: Interview duration in minutes, minimum value is 1.
          - name: feedback_reminder
            description: > 
              Frequency of feedback reminders (i.e. once, daily, frequently, none).
              Defaults to 'frequently' which is every 6 hours.
          - name: gcal_event_url
            description: Google calendar event url. 
          - name: location
            description: >
              Interview location. Usually the name of a booked conference room but can also be a 
              phone number to call.
          - name: note
            description: Interview note.
          - name: panel_id
            description: Unique id of the PANEL this interview belongs to.
          - name: stage_id
            description: >
              Foreign key referencing the STAGE that the candidate was in at the time 
              the interview was scheduled.
          - name: subject
            description: Subject of the interview. 
          - name: timezone
            description: Name of timezone in which interview was scheduled to occur.
          - name: opportunity_id
            description: Foreign key referencing the OPPORTUNITY being interviewed for. 

      - name: panel 
        description: >
          Table capturing interview panels, which each contain a series of interviews that will take place for a 
          given candidate during a stage in their opportunity journey.
        columns:
          - name: id 
            description: Unique id of the panels. 
          - name: canceled_at
            description: Timestamp of when the panel was canceled.
          - name: created_at
            description: Timestamp of when the panel was created.
          - name: creator_id
            description: Foreign key referencing the USER that created the panel. 
          - name: end
            description: Timestamp of when the last interview in the panel ends. 
          - name: external_url
            description: URL that links to an external entity associated with this interview.
          - name: externally_managed
            description: Boolean tht is true if panels are created via the API, or via an integration.
          - name: feedback_reminder
            description: >
              Frequency of feedback reminders (i.e. once, daily, frequently, none). Defaults to 'frequently',
              which is every 6 hours
          - name: note 
            description: Note on the panel.
          - name: stage_id
            description: Foreign key referencing the STAGE that the candidate was in when the panel was scheduled. 
          - name: start
            description: Timestamp of when the first interview in the panel started. 
          - name: timezone
            description: Name of timezone in which panel was scheduled to occur.

      - name: panel_interview
      - name: panel_application
      - name: interview_feedback
      - name: feedback_form
      - name: feedback_form_field
      - name: requisition
      - name: requisition_posting
      - name: posting_form
      - name: posting_form_field