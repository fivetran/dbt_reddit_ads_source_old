# for source packages/pulling from the raw connector data

version: 2

sources:
  - name: lever 
    database: "{{ var ('lever_database', target.database) }}"
    schema: "{{ var ('lever_schema', 'lever') }}"

    loader: fivetran
    loaded_at_field: _fivetran_synced
      
    freshness:
      warn_after: {count: 72, period: hour}
      error_after: {count: 96, period: hour}

    # do tests on staging models bc of circleci testing
    tables:
      - name: opportunity
        description: > 
          Opportunities represent each candidates' individual journeys/candidacies through
          your pipeline. An individual candidate might have multiple opportunties if
          applying to multiple job postings. 
        columns:
          - name: id
            description: Unique ID of the opportunity.
          - name: archived_at
            description: Timestamp of when the opportunity was archived. 
          - name: archived_reason_id
            description: Foreign key referencing the ARCHIVE_REASON for which the opportunity was archived.
          - name: contact
            description: Foreign key referencing the CONTACT info of the candidate applying in this opportunity.
          - name: created_at
            description: >
              Timestamp of when the opportunity was created (ie when the candidate clicked "apply" on your
              company website).
          - name: data_protection_contact_allowed
            description: >
              Boolean that is true if relevant data policy regulations allow for contacting 
              this opportunity's candidate.
          - name: data_protection_contact_expires_at
            description: Timestamp of when this permission/data policy expires.
          - name: data_protection_store_allowed
            description: >
              Boolean that is true if relevant data policy regulations allow for storing 
              this opportunity record.
          - name: data_protection_store_expires_at
            description: Timestamp of when this permission/data policy expires.
          - name: headline
            description: > 
              Contact headline, typically a list of previous companies where the contact has worked or 
              schools that the contact has attended.
          - name: is_anonymized
            description: >
              Boolean that is true if the opportunity has been anonymized (therefore fully anonymizing 
              the contact and removing their *personal* information).
          - name: last_advanced_at
            description: >
              Timestamp of when the candidate advanced to their current stage in the hiring pipeline.
          - name: last_interaction_at
            description: >
              Timestamp of when the Opportunity profile was last interacted with. See interactions
              [here](https://help.lever.co/hc/en-us/articles/205697619).
          - name: location
            description: Current contact location of the candidate.
          - name: name
            description: Contact full name.
          - name: origin
            description: >
              The way in which the opportunity was added to lever. Includes 'agency', 'applied', 'internal',
              'referred', 'sourced', and 'university'.
          - name: owner_id
            description: Foreign key referencing the id of the USER who owns this opportunity.
          - name: snoozed_until
            description: Timestamp of when the current snooze period of this opportunity ends (if snoozed).
          - name: stage_id
            description: Foreign key referencing the ID of the current stage of the opportunity.
          - name: updated_at
            description: Timestamp of when the opportunity was last updated in lever.

      - name: posting
        description: Table capturing job postings that candidates can apply to.
        columns:
          - name: id
            description: Unique ID of the job posting. 
          - name: _fivetran_deleted
            description: Boolean that is true if the posting has been soft-deleted.
          - name: categories_commitment
            description: Tag for job position work type (e.g. Full-time, Part-time, Internship).
          - name: categories_department
            description: Tag for the department to which the job posting's team belongs, if present.
          - name: categories_level
            description: >
              Tag for job posting level (e.g. Senior, Junior). Note - this has been deprecated by Lever 
              but is currently maintained for backward compatibility.
          - name: categories_location
            description: Tag for job position location.
          - name: categories_team
            description: >
              Tag for the team to which the job posting belongs (a sub-category of department).
          - name: content_closing
            description: Closing statement on the job posting, in plaintext. 
          - name: content_closing_html
            description: Closing statement on job posting, as styled HTML.
          - name: content_description
            description: Job posting description that is shown at the top of the job's page, as plaintext.
          - name: content_description_html
            description: Job posting description that is shown at the top of the job's page, in HTML.
          - name: created_at
            description: Timestamp of when the posting was created in Lever.
          - name: creator_id
            description: Foreign key referencing the id of the USER who created the job posting. 
          - name: owner_id
            description: >
              Foreign key referencing the id of the USER who owns the posting. The posting owner is the 
              individual who is directly responsible for managing all candidates who are applied to that role.
          - name: requisition_code
            description: Array of requisition codes associated with this posting.
          - name: state
            description: >
              Current status of the posting, which may include 'published', 'internal' (called 'unlisted' in the UI),
              'closed', 'draft', 'pending' (awaiting approval), and 'rejected'.
          - name: text
            description: Title of the job posting role.
          - name: updated_at
            description: Timestamp of when the posting was last updated.

      - name: posting_tag
        description: Table associating job postings with all associated tags.
        columns:
          - name: posting_id
            description: Foreign key referencing the id of the job POSTING.
          - name: tag 
            description: Text of the posting's individual tag.
          - name: _fivetran_deleted
            description: Boolean that is true if the posting-tag association has been deleted.
            
      - name: posting_interview
        description: Table relating job postings to any interviews undertaken for the role.
        columns:
          - name: interview_id
            description: Foreign key referencing the INTERVIEW for this job posting.
          - name: posting_id
            description: Foreign key referencing the POSTING that was interviewed for.

      - name: user
        description: Table of Lever users (anyone who has been invited to join the recruiting efforts).
        columns:
          - name: id
            description: Unique id of the user. 
          - name: _fivetran_deleted
            description: Boolean that is true if the user has been soft-deleted. 
          - name: access_role
            description: >
              The user's access role, which can be 'super admin', 'admin', 'team member', 'limited team member', or 'interviewer'.
              Information on what the roles entail can be found 
              [here](https://help.lever.co/hc/en-us/articles/360042645691-What-are-the-differences-between-access-roles-in-Lever-#:~:text=There%20are%205%20different%20access,information%2C%20and%20permission%20granting%20privileges).
          - name: created_at
            description: Timestamp of when the user was created. 
          - name: deactivated_at
            description: Timestamp of when the user was deactivated (null for active users). 
          - name: email
            description: The user's email address.
          - name: external_directory_id
            description: Unique ID of the user in an external HR directory, if provided.
          - name: name
            description: User's preferred name.
          - name: photo
            description: URL for user's gravatar, if enabled.
          - name: username
            description: Username, extracted from user's email address.

      - name: interview_user
        description: Table relating interviews to their interviewers.
        columns:
          - name: interview_id
            description: Foreign key referencing the INTERVIEW that was given.
          - name: user_id 
            description: Foreign key referencing the USER that interviewed the candidate.

      - name: opportunity_stage_history
        description: Table capturing the different stages that each opportunity has passed through in the pipeline.
        columns:
          - name: opportunity_id
            description: Foreign key referencing the id of the OPPORTUNITY.
          - name: updated_at
            description: Timestamp of when the opportunity was changed to this stage.
          - name: stage_id
            description: Foreign key referencing the STAGE that the opportunity was changed to.
          - name: updater_id
            description: Foreign key referencing the USER who changed the opportunity stage.

      - name: stage
        description: Table of steps in the recruiting workflow of your hiring pipeline.
        columns:
          - name: id
            description: Unique id of the stage.
          - name: text
            description: Title of the stage.

      # - name: contact - todo, contact does not exist in our data
      #   description: Table of the contacts for all candidates.
        # columns:
        #   - name: 
      - name: opportunity_source
        description: Table relating opportunities to all of their individual sources. 
        columns:
          - name: opportunity_id
            description: Foreign key referencing the OPPORTUNITY that was sourced. 
          - name: source
            description: Where this opportunity was sourced from (ie 'linkedin').

      - name: opportunity_tag 
        description: Table relating opportunities to their tags.
        columns:
          - name: opportunity_id
            description: Foreign key referencing the OPPORTUNITY that was tagged.
          - name: tag
            description: Text of the tag associated with this opportunity.

      - name: application
      - name: posting_form
      - name: offer
      - name: archive_reason 
         